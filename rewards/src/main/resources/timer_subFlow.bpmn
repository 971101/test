<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bpmn:definitions targetNamespace="http://www.omg.org/spec/BPMN/20100524/MODEL" exporter="jBPMN NB" exporterVersion="0.3" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:java="http://jcp.org/en/jsr/detail?id=270" xmlns:jbpmn="http://jbpmn.java.net" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL">
    <bpmn:itemDefinition structureRef="String" itemKind="Physical" id="String"/>
    <bpmn:itemDefinition structureRef="Long" itemKind="Physical" id="Long"/>
    <bpmn:itemDefinition structureRef="java.util.Set" id="ItemDefinition_1"/>
    <bpmn:itemDefinition structureRef="java.util.Map" id="ItemDefinition_2"/>
    <bpmn:signal name="stopProcess" id="Signal_1"/>
    <bpmn:signal name="Signal 2" id="Signal_2"/>
    <bpmn:process isClosed="false" name="timer_subFlow" id="timer_subFlow">
        <bpmn:property itemSubjectRef="String" id="name"/>
        <bpmn:property itemSubjectRef="String" id="processInstanceId"/>
        <bpmn:property itemSubjectRef="String" id="stopProcess"/>
        <bpmn:property itemSubjectRef="String" id="result"/>
        <bpmn:property itemSubjectRef="String" id="restart"/>
        <bpmn:property itemSubjectRef="String" id="type"/>
        <bpmn:property itemSubjectRef="String" id="signal"/>
        <bpmn:property itemSubjectRef="String" id="output1"/>
        <bpmn:property name="ParentProcessInstanceId" itemSubjectRef="Long" id="ParentProcessInstanceId"/>
        <bpmn:property name="timestamp" itemSubjectRef="String" id="timestamp"/>
        <bpmn:property name="counter" itemSubjectRef="Long" id="counter"/>
        <bpmn:property name="taskname" itemSubjectRef="String" id="taskname"/>
        <bpmn:scriptTask isForCompensation="false" startQuantity="1" completionQuantity="1" name="initial" id="_1423792335617">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":2.5}},"inner":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(255,248,159)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1427268750065</bpmn:incoming>
            <bpmn:outgoing>_1434952590468</bpmn:outgoing>
            <bpmn:script>String Input5 = (String)kcontext.getVariable("input5");
System.out.println("in timersubflow Input5:"+Input5);
kcontext.setVariable("taskname", Input5);

kcontext.setVariable("counter", (Long)0);

//String glbName = (String)kcontext.getKnowledgeRuntime().getGlobal("name");
//String glbProcessInstanceId = (String)kcontext.getKnowledgeRuntime().getGlobal("glbProcessInstanceId");
//String glbstopProcess = (String)kcontext.getKnowledgeRuntime().getGlobal("glbstopProcess");
//Long glbLastWorkItemId = (Long)kcontext.getKnowledgeRuntime().getGlobal("glbLastWorkItemId");

String glbtype = (String)kcontext.getKnowledgeRuntime().getGlobal("glbType");
System.out.println("glbtype=&gt;"+glbtype);
//kcontext.setVariable("type",glbtype);

String glbtimestamp = (String)kcontext.getKnowledgeRuntime().getGlobal("glbtimestamp");
System.out.println("glbtimestamp=&gt;"+glbtimestamp);
String Input4 = (String)kcontext.getVariable("input4");

kcontext.setVariable("timestamp", Input4);


String Input2 = (String)kcontext.getVariable("input2");
kcontext.setVariable("type", Input2);


System.out.println("before glbName=&gt;"+(String)kcontext.getKnowledgeRuntime().getGlobal("name"));

String Input3 = (String)kcontext.getVariable("input3");
kcontext.setVariable("name", Input3);

String Input1 = (String)kcontext.getVariable("input1");
kcontext.setVariable("processInstanceId", Input1);

if((String)kcontext.getKnowledgeRuntime().getGlobal("glbProcessInstanceId")==null){
kcontext.getKnowledgeRuntime().setGlobal("glbProcessInstanceId", Input1);
//glbProcessInstanceId = (String)kcontext.getKnowledgeRuntime().getGlobal("glbProcessInstanceId");

}


System.out.println("before glbProcessInstanceId=&gt;"+(String)kcontext.getKnowledgeRuntime().getGlobal("glbProcessInstanceId"));
 
 
kcontext.setVariable("stopProcess", (String)kcontext.getKnowledgeRuntime().getGlobal("glbstopProcess"));
 
kcontext.setVariable("restart","False");
  

//System.out.println("java tmp stop process=&gt;"+tmp.Tmp.getStopProcess());


//kcontext.getKieRuntime().signalEvent("Signal_2", "AA");




                
if (((org.jbpm.workflow.instance.impl.WorkflowProcessInstanceImpl) kcontext.getProcessInstance()).getMetaData().containsKey("ParentProcessInstanceId")) {  
    ((org.jbpm.workflow.instance.impl.WorkflowProcessInstanceImpl) kcontext.getProcessInstance()).setVariable("ParentProcessInstanceId", ((org.jbpm.workflow.instance.impl.WorkflowProcessInstanceImpl) kcontext.getProcessInstance()).getMetaData().get("ParentProcessInstanceId"));  
}

System.out.println("in subflow ParentProcessInstanceId=&gt;"+kcontext.getVariable("ParentProcessInstanceId"));

Long PPID = (Long)kcontext.getNodeInstance().getVariable("ParentProcessInstanceId");
Long PID = (Long)kcontext.getProcessInstance().getId();
Long e = (Long)22;
 String Timestamp = (String)kcontext.getVariable("timestamp"); 

//if(tmp.Tmp.getSubProcessList().containsKey(PPID)){
tmp.Tmp.addSubProcessList(Timestamp,PPID,PID);//get(PPID).add(PID);

//}
</bpmn:script>
        </bpmn:scriptTask>
        <bpmn:scriptTask isForCompensation="false" startQuantity="1" completionQuantity="1" name="finish" id="_1423794118389">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":2.5}},"inner":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(255,248,159)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1434952598407</bpmn:incoming>
            <bpmn:outgoing>_1427349176352</bpmn:outgoing>
            <bpmn:script> 
String Timestamp =  (String)kcontext.getVariable("timestamp");

kcontext.getKnowledgeRuntime().setGlobal("name", kcontext.getVariable("name"));

System.out.println("after glbName=&gt;"+kcontext.getKnowledgeRuntime().getGlobal("name"));
System.out.println("after sub processInstanceId=&gt;"+kcontext.getVariable("processInstanceId"));
System.out.println("after sub stopProcess=&gt;"+kcontext.getVariable("stopProcess"));

kcontext.getKnowledgeRuntime().setGlobal("glbstopProcess", kcontext.getVariable("stopProcess"));

kcontext.getKnowledgeRuntime().setGlobal("glbstopProcess",  kcontext.getVariable("stopProcess"));
System.out.println("after glbstopProcess=&gt;"+kcontext.getKnowledgeRuntime().getGlobal("glbstopProcess"));

System.out.println("after sub result=&gt;"+kcontext.getVariable("result"));
 
 String processInstanceId = (String)kcontext.getVariable("processInstanceId");
 System.out.println("in sub finish processInstanceId:"+processInstanceId);

String Restart = (String)kcontext.getVariable("restart");
//String index = tmp.Tmp.getTaskDataList().get(Long.valueOf(processInstanceId)).getTaskName();
String index = tmp.Tmp.getTaskName(Long.valueOf(processInstanceId));

	//String[] provisionData = (String[])tmp.Tmp.getTaskDataList().get(Long.valueOf(processInstanceId)).getProvisionData();
	String[] provisionData = (String[])tmp.Tmp.getProvisionData(Long.valueOf(processInstanceId));
		
	String taskListSize = "0";
	
	//if(((String)tmp.Tmp.getTaskDataList().get(Long.valueOf(processInstanceId)).getType()).equals("FlowCounter")){
    if(((String)tmp.Tmp.getType(Long.valueOf(processInstanceId))).equals("FlowCounter")){

     	System.out.println("bpmn in flowcounter!");
	     taskListSize = "2";
	
	}else {
	    taskListSize = String.valueOf(provisionData.length);
	
	}
	 
						  
			System.out.println("resource staticTaskData.getTaskName()=&gt;"+index);
			System.out.println("resource staticTaskData.getProvisionData() length=&gt;"+taskListSize);
	

if(Restart=="False"){

System.out.println("finish mary restart == false");
	String  Taskname = (String)kcontext.getVariable("name");
	 

	
Taskname =  String.valueOf(Integer.valueOf(Taskname)+1);
                       System.out.println("in finish Taskname=&gt;"+Taskname);

	kcontext.setVariable("name", Taskname);
                        kcontext.setVariable("output1", Taskname);

	kcontext.getKnowledgeRuntime().setGlobal("name", kcontext.getVariable("name"));
	
	//DB.DBConnectionDemo.excecuteSql("wslog","insert into `core_task` (`processInstanceId`,`Taskname`, `TaskTime`,`TaskResponseTime`, `TaskResult`,`TaskErrorCode`) values (\'"+processInstanceId+"\',\'"+tmp.Tmp.getTaskName(Long.valueOf(processInstanceId))+"\',\'"+tmp.Tmp.getRequestTime(Long.valueOf(processInstanceId))+"\',\'"+tmp.Tmp.getResponseTime(Long.valueOf(processInstanceId))+"\',\'"+tmp.Tmp.getResult(Long.valueOf(processInstanceId))+"\',\'"+tmp.Tmp.getErrorCode(Long.valueOf(processInstanceId))+"\')");    


//if(index.equals(taskListSize)){
 if(false){
	    System.out.println("index==tasklistsize");   
		   
		//tmp.Tmp.getProcessList().remove(Long.valueOf(processInstanceId));
//no more processlist		
//tmp.Tmp.removeProcessList(Timestamp,Long.valueOf(processInstanceId));
//DB.DBConnectionDemo.excecuteSql("bpmdata", "update `processdata` set `isfinished`='yes' where `starttime`='"+Timestamp+"';");

//DB.DBConnectionDemo.excecutejpaSql("bpmdata", "update `processdata` set `isfinished`='yes' where `starttime`='"+Timestamp+"';");


String ft = tool.getDate.getDate();

System.out.println("ft:"+ft);

 

DB.DBConnectionDemo.excecutejpaSql("bpmdata", "update `processdata` set `isfinished`='yes', `finishtime`='"+ft+"'  where `starttime`='"+Timestamp+"';");

 


tmp.Tmp.removestarttimeList(Timestamp,Long.valueOf(processInstanceId));
tmp.Tmp.removeStopProcessList(Long.valueOf(Long.valueOf(processInstanceId)));
//tmp.Tmp.removeTaskDataList(Long.valueOf(Long.valueOf(processInstanceId)));
		//tool.FileIO.delPID("/home/syscom/PID.txt", processInstanceId);
//no more processlist		 
//DB.DBConnectionDemo.editRuntimeval("processlist",processInstanceId,"del");

      
		//tmp.Tmp.getSubProcessList().remove(Long.valueOf(processInstanceId)); 
        tmp.Tmp.removeSubProcessList(Long.valueOf(processInstanceId));		
		   
 
		 
		//if(tmp.Tmp.getTaskDataList().get(Long.valueOf(processInstanceId)).isNeedCallback()==true){
		if(tmp.Tmp.isNeedCallback(Long.valueOf(processInstanceId))==true){
    
			System.out.println("in finish  needcallback!");
				 
				 

			ws_client.Tester tt = new ws_client.Tester();
		 	   
			//when test use the follwing line
			tt.testWSClient1("http://"+ws_client.Tester.webIP+":"+ws_client.Tester.webPort+"/"+ws_client.Tester.webTag+"/taskCallback", new model.TaskData(processInstanceId,tmp.Tmp.getTaskName(Long.valueOf(processInstanceId)),tmp.Tmp.getRequestTime(Long.valueOf(processInstanceId)),tmp.Tmp.getResponseTime(Long.valueOf(processInstanceId)),tmp.Tmp.getResult(Long.valueOf(processInstanceId)),tmp.Tmp.getErrorCode(Long.valueOf(processInstanceId)),tmp.Tmp.getType(Long.valueOf(processInstanceId)),tmp.Tmp.getProvisionData(Long.valueOf(processInstanceId)),tmp.Tmp.isNeedCallback(Long.valueOf(processInstanceId))));
                     
		}
	 
	}

}else{


System.out.println("not final task:"+Taskname);

}

System.out.println("finish processinstances=&gt;"+kcontext.getKieRuntime().getProcessInstances().toString());
 
//tmp.Tmp.getTaskDataList().get(Long.valueOf(processInstanceId)).setResult(null);
//tmp.Tmp.setResult(Long.valueOf(processInstanceId),null);


String glbProcessInstanceId = (String)kcontext.getKnowledgeRuntime().getGlobal("glbProcessInstanceId");
String Input1 = (String)kcontext.getVariable("input1");

if(glbProcessInstanceId==null){
kcontext.getKnowledgeRuntime().setGlobal("glbProcessInstanceId", Input1);
glbProcessInstanceId = (String)kcontext.getKnowledgeRuntime().getGlobal("glbProcessInstanceId");

}


System.out.println("after glbProcessInstanceId=&gt;"+glbProcessInstanceId);

//new
if(tmp.Tmp.getStopProcessList().contains(Long.valueOf((String)kcontext.getKieRuntime().getGlobal("glbProcessInstanceId")))){
       
                           if(kcontext.getNodeInstance().getNodeName().equals("finish")){

                              kcontext.getKieRuntime().abortProcessInstance(kcontext.getProcessInstance().getId());
                           
                             if(kcontext.getKieRuntime().getProcessInstance(Long.valueOf((String)kcontext.getKieRuntime().getGlobal("glbProcessInstanceId")))!=null){
                                kcontext.getKieRuntime().abortProcessInstance(Long.valueOf((String)kcontext.getKieRuntime().getGlobal("glbProcessInstanceId")));
                            }
                            
                        
                            System.out.println("eventlistener processinstance=&gt;"+kcontext.getKieRuntime().getProcessInstances().toString());
                      
                        //no more processlist  
                        //tmp.Tmp.removeProcessList(Timestamp,Long.valueOf((String)kcontext.getKieRuntime().getGlobal("glbProcessInstanceId")));  
//DB.DBConnectionDemo.excecuteSql("bpmdata", "update `processdata` set `isfinished`='yes' where `starttime`='"+Timestamp+"';");

String ft = tool.getDate.getDate();
System.out.println("ft:"+ft);
 
DB.DBConnectionDemo.excecutejpaSql("bpmdata", "update `processdata` set `isfinished`='yes', `finishtime`='"+ft+"' where `starttime`='"+Timestamp+"';");
 
tmp.Tmp.removestarttimeList(Timestamp,Long.valueOf((String)kcontext.getKieRuntime().getGlobal("glbProcessInstanceId"))); 
//tmp.Tmp.removeTaskDataList(Long.valueOf(Long.valueOf(processInstanceId)));
                        //tool.FileIO.delPID("/home/syscom/PID.txt", (String)kcontext.getKieRuntime().getGlobal("glbProcessInstanceId"));
						 //DB.DBConnectionDemo.editRuntimeval("processlist",(String)kcontext.getKieRuntime().getGlobal("glbProcessInstanceId"),"del");
						
                        //tmp.Tmp.removeSubProcessList(Long.valueOf((String)kcontext.getKieRuntime().getGlobal("glbProcessInstanceId")));
                        
                        tmp.Tmp.removeStopProcessList(Long.valueOf((String)kcontext.getKieRuntime().getGlobal("glbProcessInstanceId")));
                            
                       
                        

                    System.out.println("eventlistener in finish!");
                    
                    }  
              
                     
                   
                }else{
        
                    System.out.println("no stop process~");
            
                }
</bpmn:script>
        </bpmn:scriptTask>
        <bpmn:task isForCompensation="false" startQuantity="1" completionQuantity="1" name="task" id="_1423796124140" taskName="xx">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":2.5}},"inner":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(255,248,159)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1434942487642</bpmn:incoming>
            <bpmn:outgoing>_1434943406550</bpmn:outgoing>
            <bpmn:ioSpecification id="_142379612547021">
                <bpmn:dataInput name="name" id="_142379615544024"/>
                <bpmn:dataInput name="processInstanceId" id="_142381116710814"/>
                <bpmn:dataInput name="stopProcess" id="_142407019493525"/>
                <bpmn:dataInput name="restart" id="_142474202473930"/>
                <bpmn:dataInput name="type" id="_142613207969619"/>
                <bpmn:dataInput name="timestamp" itemSubjectRef="String" isCollection="false" id="_143252617197520"/>
                <bpmn:dataInput name="taskname" itemSubjectRef="String" isCollection="false" id="_143563138937926"/>
                <bpmn:dataOutput name="name" id="_142379616348827"/>
                <bpmn:dataOutput name="result" id="_142407565889121"/>
                <bpmn:dataOutput name="restart" id="_142474259976144"/>
                <bpmn:inputSet id="_143563139279927">
                    <bpmn:dataInputRefs>_142379615544024</bpmn:dataInputRefs>
                    <bpmn:dataInputRefs>_142381116710814</bpmn:dataInputRefs>
                    <bpmn:dataInputRefs>_142407019493525</bpmn:dataInputRefs>
                    <bpmn:dataInputRefs>_142474202473930</bpmn:dataInputRefs>
                    <bpmn:dataInputRefs>_142613207969619</bpmn:dataInputRefs>
                    <bpmn:dataInputRefs>_143252617197520</bpmn:dataInputRefs>
                    <bpmn:dataInputRefs>_143563138937926</bpmn:dataInputRefs>
                </bpmn:inputSet>
                <bpmn:outputSet id="_142735302138988">
                    <bpmn:dataOutputRefs>_142379616348827</bpmn:dataOutputRefs>
                    <bpmn:dataOutputRefs>_142407565889121</bpmn:dataOutputRefs>
                    <bpmn:dataOutputRefs>_142474259976144</bpmn:dataOutputRefs>
                </bpmn:outputSet>
            </bpmn:ioSpecification>
            <bpmn:dataInputAssociation id="_142379615544023">
                <bpmn:sourceRef>name</bpmn:sourceRef>
                <bpmn:targetRef>_142379615544024</bpmn:targetRef>
            </bpmn:dataInputAssociation>
            <bpmn:dataInputAssociation id="_142381116710813">
                <bpmn:sourceRef>processInstanceId</bpmn:sourceRef>
                <bpmn:targetRef>_142381116710814</bpmn:targetRef>
            </bpmn:dataInputAssociation>
            <bpmn:dataInputAssociation id="_142407019493524">
                <bpmn:sourceRef>stopProcess</bpmn:sourceRef>
                <bpmn:targetRef>_142407019493525</bpmn:targetRef>
            </bpmn:dataInputAssociation>
            <bpmn:dataInputAssociation id="_142474202473929">
                <bpmn:sourceRef>restart</bpmn:sourceRef>
                <bpmn:targetRef>_142474202473930</bpmn:targetRef>
            </bpmn:dataInputAssociation>
            <bpmn:dataInputAssociation id="_142613207969618">
                <bpmn:sourceRef>type</bpmn:sourceRef>
                <bpmn:targetRef>_142613207969619</bpmn:targetRef>
            </bpmn:dataInputAssociation>
            <bpmn:dataInputAssociation id="_143252617197519">
                <bpmn:sourceRef>timestamp</bpmn:sourceRef>
                <bpmn:targetRef>_143252617197520</bpmn:targetRef>
            </bpmn:dataInputAssociation>
            <bpmn:dataInputAssociation id="_143563138937925">
                <bpmn:sourceRef>taskname</bpmn:sourceRef>
                <bpmn:targetRef>_143563138937926</bpmn:targetRef>
            </bpmn:dataInputAssociation>
            <bpmn:dataOutputAssociation id="_142379616348826">
                <bpmn:sourceRef>_142379616348827</bpmn:sourceRef>
                <bpmn:targetRef>name</bpmn:targetRef>
            </bpmn:dataOutputAssociation>
            <bpmn:dataOutputAssociation id="_142407565889120">
                <bpmn:sourceRef>_142407565889121</bpmn:sourceRef>
                <bpmn:targetRef>result</bpmn:targetRef>
            </bpmn:dataOutputAssociation>
            <bpmn:dataOutputAssociation id="_142474259976143">
                <bpmn:sourceRef>_142474259976144</bpmn:sourceRef>
                <bpmn:targetRef>restart</bpmn:targetRef>
            </bpmn:dataOutputAssociation>
        </bpmn:task>
        <bpmn:endEvent name="innerEnd" id="_1423812167017">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":3.0}},"inner":{"background":{"startColor":"RGB(30,69,123)","endColor":"RGB(30,69,123)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1427349176352</bpmn:incoming>
            <bpmn:terminateEventDefinition id="_142381216702923"/>
        </bpmn:endEvent>
        <bpmn:userTask implementation="##unspecified" isForCompensation="false" startQuantity="1" completionQuantity="1" name="Fail Task Issue" id="_1424058280287">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":2.5}},"inner":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(255,248,159)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1435126148429</bpmn:incoming>
            <bpmn:outgoing>_1424075591908</bpmn:outgoing>
            <bpmn:ioSpecification id="_1424068076771174">
                <bpmn:dataInput name="Skippable" id="DataInput_5"/>
                <bpmn:dataOutput name="restart" id="_142407670120845"/>
                <bpmn:inputSet id="_143617315690815">
                    <bpmn:dataInputRefs>DataInput_5</bpmn:dataInputRefs>
                </bpmn:inputSet>
                <bpmn:outputSet id="_143617316167616">
                    <bpmn:dataOutputRefs>_142407670120845</bpmn:dataOutputRefs>
                </bpmn:outputSet>
            </bpmn:ioSpecification>
            <bpmn:dataInputAssociation id="DataInputAssociation_5">
                <bpmn:targetRef>DataInput_5</bpmn:targetRef>
                <bpmn:assignment id="Assignment_5">
                    <bpmn:from id="FormalExpression_1">true</bpmn:from>
                    <bpmn:to xsi:type="bpmn:tFormalExpression" id="FormalExpression_10">DataInput_5</bpmn:to>
                </bpmn:assignment>
            </bpmn:dataInputAssociation>
            <bpmn:dataOutputAssociation id="_142407670120844">
                <bpmn:sourceRef>_142407670120845</bpmn:sourceRef>
                <bpmn:targetRef>restart</bpmn:targetRef>
            </bpmn:dataOutputAssociation>
            <bpmn:potentialOwner id="_1424058458523135">
                <bpmn:resourceAssignmentExpression id="ResourceAssignmentExpression_1">
                    <bpmn:formalExpression id="FormalExpression_1">mary</bpmn:formalExpression>
                </bpmn:resourceAssignmentExpression>
            </bpmn:potentialOwner>
            <bpmn:potentialOwner id="_143617323479617">
                <bpmn:resourceAssignmentExpression>
                    <bpmn:formalExpression>peter</bpmn:formalExpression>
                </bpmn:resourceAssignmentExpression>
            </bpmn:potentialOwner>
        </bpmn:userTask>
        <bpmn:exclusiveGateway gatewayDirection="Diverging" name="" id="_1424075581072">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":1.5}},"inner":{"background":{"startColor":"RGB(30,69,123)","endColor":"RGB(30,69,123)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1434943413435</bpmn:incoming>
            <bpmn:outgoing>_1435126148429</bpmn:outgoing>
            <bpmn:outgoing>_1435126183847</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:exclusiveGateway gatewayDirection="Converging" name="" id="_1424075585184">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":1.5}},"inner":{"background":{"startColor":"RGB(30,69,123)","endColor":"RGB(30,69,123)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1424075591908</bpmn:incoming>
            <bpmn:incoming>_1435126183847</bpmn:incoming>
            <bpmn:outgoing>_1434943416402</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow sourceRef="_1424058280287" targetRef="_1424075585184" id="_1424075591908" drools:priority="1" xmlns:drools="http://www.jboss.org/drools"/>
        <bpmn:exclusiveGateway gatewayDirection="Diverging" name="gateway2" id="_1424076490055">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":1.5}},"inner":{"background":{"startColor":"RGB(30,69,123)","endColor":"RGB(30,69,123)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1434943416402</bpmn:incoming>
            <bpmn:outgoing>_1434952592924</bpmn:outgoing>
            <bpmn:outgoing>_1434952598407</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:startEvent isInterrupting="true" parallelMultiple="false" name="innerStart" id="_1423790747732">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":1.0}},"inner":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(255,248,159)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:outgoing>_1427268750065</bpmn:outgoing>
        </bpmn:startEvent>
        <bpmn:sequenceFlow sourceRef="_1423790747732" targetRef="_1423792335617" id="_1427268750065" drools:priority="1" xmlns:drools="http://www.jboss.org/drools"/>
        <bpmn:sequenceFlow sourceRef="_1423794118389" targetRef="_1423812167017" id="_1427349176352"/>
        <bpmn:intermediateCatchEvent parallelMultiple="false" name="restartTimer" id="_1434941439826">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(30,69,123)","width":1.0}},"inner":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1434943403434</bpmn:incoming>
            <bpmn:outgoing>_1434941499497</bpmn:outgoing>
            <bpmn:timerEventDefinition id="_143494143984213">
                <bpmn:timeDuration id="_143494445368141">5000</bpmn:timeDuration>
            </bpmn:timerEventDefinition>
        </bpmn:intermediateCatchEvent>
        <bpmn:exclusiveGateway gatewayDirection="Converging" id="_1434941485612">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":1.5}},"inner":{"background":{"startColor":"RGB(30,69,123)","endColor":"RGB(30,69,123)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1434941499497</bpmn:incoming>
            <bpmn:incoming>_1434952595168</bpmn:incoming>
            <bpmn:outgoing>_1434942487642</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow sourceRef="_1434941439826" targetRef="_1434941485612" id="_1434941499497"/>
        <bpmn:sequenceFlow sourceRef="_1434941485612" targetRef="_1423796124140" id="_1434942487642"/>
        <bpmn:exclusiveGateway gatewayDirection="Diverging" id="_1434943392768">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":1.5}},"inner":{"background":{"startColor":"RGB(30,69,123)","endColor":"RGB(30,69,123)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1434943406550</bpmn:incoming>
            <bpmn:outgoing>_1434943403434</bpmn:outgoing>
            <bpmn:outgoing>_1434943413435</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow sourceRef="_1434943392768" targetRef="_1434941439826" id="_1434943403434">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" id="_143494343528537">Long Counter = (Long)kcontext.getVariable("counter");
if(Counter==null){
kcontext.setVariable("counter", (Long)0);
System.out.println("return counter:"+kcontext.setVariable("counter"));
Counter = (Long)kcontext.getVariable("counter");
System.out.println("in auto subflow CounterQQ:"+Counter);

}else {

System.out.println("in auto subflow Counter:"+Counter);

}

String Result = (String)kcontext.getVariable("result");


String Restart = "False";


if(Result.equals("Fail")){


if(Counter==3){

Restart = "False";
kcontext.setVariable("restart",Restart);
 
}else {

Restart = "True";
  Counter = Counter+1;
kcontext.setVariable("counter",Counter);
kcontext.setVariable("restart",Restart);
  System.out.println("String to int in auto:"+Counter);
} 
}else {




}





//String Restart = (String)kcontext.getVariable("restart");
System.out.println("in subflow2 Restart=&gt;"+Restart);
if(Restart=="True"){
System.out.println("mary restart == true");
 kcontext.getKieRuntime().getWorkItemManager().registerWorkItemHandler("xx", new handler.TestWorkItemHandler1());

return true;
}else{
System.out.println("mary restart == false");
kcontext.getKieRuntime().getWorkItemManager().registerWorkItemHandler("xx", new handler.TestWorkItemHandler1());

return false;
}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow sourceRef="_1423796124140" targetRef="_1434943392768" id="_1434943406550"/>
        <bpmn:sequenceFlow sourceRef="_1434943392768" targetRef="_1424075581072" id="_1434943413435">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" id="_143494347331239">String Restart = (String)kcontext.getVariable("restart");

System.out.println("in subflow1 Restart=&gt;"+Restart);

if(Restart=="False"){
System.out.println("mary restart == false");
 kcontext.getKieRuntime().getWorkItemManager().registerWorkItemHandler("xx", new handler.TestWorkItemHandler1());
kcontext.setVariable("counter", (Long)0);
System.out.println("return counter:"+kcontext.getVariable("counter"));


return true;
}else{
System.out.println("mary restart == true");
kcontext.getKieRuntime().getWorkItemManager().registerWorkItemHandler("xx", new handler.TestWorkItemHandler1());

return false;
}
 
</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow sourceRef="_1424075585184" targetRef="_1424076490055" id="_1434943416402"/>
        <bpmn:exclusiveGateway gatewayDirection="Converging" id="_1434952588401">
            <bpmn:extensionElements>
                <jbpmn:ShapeDesign>{"outer":{"background":{"startColor":"RGB(255,255,255)","endColor":"RGB(226,232,236)"},"border":{"color":"RGB(108,142,183)","width":1.5}},"inner":{"background":{"startColor":"RGB(30,69,123)","endColor":"RGB(30,69,123)"},"border":{"color":"RGB(30,69,123)","width":1.0}}}</jbpmn:ShapeDesign>
            </bpmn:extensionElements>
            <bpmn:incoming>_1434952590468</bpmn:incoming>
            <bpmn:incoming>_1434952592924</bpmn:incoming>
            <bpmn:outgoing>_1434952595168</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow sourceRef="_1423792335617" targetRef="_1434952588401" id="_1434952590468"/>
        <bpmn:sequenceFlow sourceRef="_1424076490055" targetRef="_1434952588401" id="_1434952592924">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" id="_143495260138672">kcontext.setVariable("counter", (Long)0);
String Restart = (String)kcontext.getVariable("restart");
System.out.println("in subflow2 Restart=&gt;"+Restart);
System.out.println("in subflow2 Counter=&gt;"+kcontext.getVariable("counter"));

if(Restart=="True"){
System.out.println("mary restart == true");
 kcontext.getKieRuntime().getWorkItemManager().registerWorkItemHandler("xx", new handler.TestWorkItemHandler1());
return true;
}else{
System.out.println("mary restart == false");
kcontext.getKieRuntime().getWorkItemManager().registerWorkItemHandler("xx", new handler.TestWorkItemHandler1());

return false;
}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow sourceRef="_1434952588401" targetRef="_1434941485612" id="_1434952595168"/>
        <bpmn:sequenceFlow sourceRef="_1424076490055" targetRef="_1423794118389" id="_1434952598407">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" id="_143495260138673">String Restart = (String)kcontext.getVariable("restart");

System.out.println("in subflow1 Restart=&gt;"+Restart);

if(Restart=="False"){
System.out.println("mary restart == false");
 kcontext.getKieRuntime().getWorkItemManager().registerWorkItemHandler("xx", new handler.TestWorkItemHandler1());


return true;
}else{
System.out.println("mary restart == true");
kcontext.getKieRuntime().getWorkItemManager().registerWorkItemHandler("xx", new handler.TestWorkItemHandler1());

return false;
}
 
</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow sourceRef="_1424075581072" targetRef="_1424058280287" id="_1435126148429">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" id="_143512615307719">String Result = (String)kcontext.getVariable("result");
System.out.println("in subflow2 result:"+Result);
if(Result=="Fail"){
System.out.println("sub task fail!!");
return true;
}else {
System.out.println("sub task fail!! success");
return false;
}

//else {
//return false;

//}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow sourceRef="_1424075581072" targetRef="_1424075585184" id="_1435126183847">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" id="_143512618631520">String Result = (String)kcontext.getVariable("result");

System.out.println("in subflow1 result:"+Result);
if(Result=="Success"){
System.out.println("sub task success!!");
return true;
}else {
System.out.println("sub task success!! fail");
return false;

}

//else {
//return false;

//}
 

</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
    </bpmn:process>
    <bpmndi:BPMNDiagram id="_143677492623266">
        <bpmndi:BPMNPlane id="_143677492623267">
            <bpmndi:BPMNShape bpmnElement="_1423792335617" id="_1423792335617_gui">
                <omgdc:Bounds x="113.0" y="43.0" width="80.0" height="64.0"/>
                <bpmndi:BPMNLabel>
                    <omgdc:Bounds x="136.0" y="115.0" width="31.0" height="21.0"/>
                </bpmndi:BPMNLabel>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1423794118389" id="_1423794118389_gui">
                <omgdc:Bounds x="659.0" y="30.0" width="80.0" height="64.0"/>
                <bpmndi:BPMNLabel>
                    <omgdc:Bounds x="682.0" y="102.0" width="30.0" height="15.0"/>
                </bpmndi:BPMNLabel>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1423796124140" id="_1423796124140_gui">
                <omgdc:Bounds x="360.0" y="189.0" width="80.0" height="64.0"/>
                <bpmndi:BPMNLabel>
                    <omgdc:Bounds x="390.0" y="261.0" width="23.0" height="19.0"/>
                </bpmndi:BPMNLabel>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1423812167017" id="_1423812167017_gui">
                <omgdc:Bounds x="764.0" y="30.0" width="42.0" height="42.0"/>
                <bpmndi:BPMNLabel>
                    <omgdc:Bounds x="758.0" y="80.0" width="52.0" height="21.0"/>
                </bpmndi:BPMNLabel>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1424058280287" id="_1424058280287_gui">
                <omgdc:Bounds x="621.0" y="219.0" width="80.0" height="64.0"/>
                <bpmndi:BPMNLabel>
                    <omgdc:Bounds x="626.0" y="291.0" width="84.0" height="19.0"/>
                </bpmndi:BPMNLabel>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1424075581072" id="_1424075581072_gui">
                <omgdc:Bounds x="552.0" y="149.0" width="42.0" height="42.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1424075585184" id="_1424075585184_gui">
                <omgdc:Bounds x="659.0" y="125.0" width="42.0" height="42.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1424076490055" id="_1424076490055_gui">
                <omgdc:Bounds x="594.0" y="62.0" width="42.0" height="42.0"/>
                <bpmndi:BPMNLabel>
                    <omgdc:Bounds x="613.0" y="108.0" width="52.0" height="19.0"/>
                </bpmndi:BPMNLabel>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1423790747732" id="_1423790747732_gui">
                <omgdc:Bounds x="44.0" y="54.0" width="42.0" height="42.0"/>
                <bpmndi:BPMNLabel>
                    <omgdc:Bounds x="35.0" y="107.0" width="55.0" height="21.0"/>
                </bpmndi:BPMNLabel>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1434941439826" id="_1434941439826_gui">
                <omgdc:Bounds x="398.0" y="107.0" width="42.0" height="42.0"/>
                <bpmndi:BPMNLabel>
                    <omgdc:Bounds x="382.0" y="153.0" width="72.0" height="15.0"/>
                </bpmndi:BPMNLabel>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1434941485612" id="_1434941485612_gui">
                <omgdc:Bounds x="315.0" y="125.0" width="42.0" height="42.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1434943392768" id="_1434943392768_gui">
                <omgdc:Bounds x="483.0" y="147.0" width="42.0" height="42.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="_1434952588401" id="_1434952588401_gui">
                <omgdc:Bounds x="265.0" y="65.0" width="42.0" height="42.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNEdge bpmnElement="_1424075591908" id="_1424075591908_gui">
                <omgdi:waypoint x="666.0" y="220.0"/>
                <omgdi:waypoint x="678.0" y="166.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1427268750065" id="_1427268750065_gui">
                <omgdi:waypoint x="86.0" y="75.0"/>
                <omgdi:waypoint x="114.0" y="75.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1427349176352" id="_1427349176352_gui">
                <omgdi:waypoint x="738.0" y="56.0"/>
                <omgdi:waypoint x="765.0" y="56.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1434941499497" id="_1434941499497_gui">
                <omgdi:waypoint x="399.0" y="132.0"/>
                <omgdi:waypoint x="356.0" y="143.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1434942487642" id="_1434942487642_gui">
                <omgdi:waypoint x="344.0" y="159.0"/>
                <omgdi:waypoint x="372.0" y="188.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1434943403434" id="_1434943403434_gui">
                <omgdi:waypoint x="485.0" y="162.0"/>
                <omgdi:waypoint x="438.0" y="136.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1434943406550" id="_1434943406550_gui">
                <omgdi:waypoint x="440.0" y="200.0"/>
                <omgdi:waypoint x="486.0" y="173.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1434943413435" id="_1434943413435_gui">
                <omgdi:waypoint x="525.0" y="167.0"/>
                <omgdi:waypoint x="550.0" y="167.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1434943416402" id="_1434943416402_gui">
                <omgdi:waypoint x="666.0" y="135.0"/>
                <omgdi:waypoint x="627.0" y="92.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1434952590468" id="_1434952590468_gui">
                <omgdi:waypoint x="191.0" y="77.0"/>
                <omgdi:waypoint x="263.0" y="77.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1434952592924" id="_1434952592924_gui">
                <omgdi:waypoint x="592.0" y="82.0"/>
                <omgdi:waypoint x="308.0" y="82.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1434952595168" id="_1434952595168_gui">
                <omgdi:waypoint x="294.0" y="99.0"/>
                <omgdi:waypoint x="327.0" y="131.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1434952598407" id="_1434952598407_gui">
                <omgdi:waypoint x="635.0" y="80.0"/>
                <omgdi:waypoint x="659.0" y="80.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1435126148429" id="_1435126148429_gui">
                <omgdi:waypoint x="585.0" y="178.0"/>
                <omgdi:waypoint x="625.0" y="218.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="_1435126183847" id="_1435126183847_gui">
                <omgdi:waypoint x="593.0" y="167.0"/>
                <omgdi:waypoint x="659.0" y="148.0"/>
            </bpmndi:BPMNEdge>
        </bpmndi:BPMNPlane>
    </bpmndi:BPMNDiagram>
</bpmn:definitions>
